<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macro Execution Dashboard</title>

<!-- Manrope Font (FTMO-style soft premium) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#0b0f14;
  --card:#121826;
  --card-border:#1e2636;
  --text:#e6edf3;
  --muted:#8b93a6;

  --bull:#00ff9c;
  --bear:#ff4d4d;
  --neutral:#ffcc00;
  --info:#4ddcff;

  --glow-bull:0 0 14px rgba(0,255,156,.45);
  --glow-bear:0 0 14px rgba(255,77,77,.45);
  --glow-neutral:0 0 14px rgba(255,204,0,.45);
  --glow-info:0 0 14px rgba(77,220,255,.45);
}

* { box-sizing:border-box; }

body {
  margin:0;
  font-family:"Manrope", Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:
    radial-gradient(1200px 600px at top, #101828 0%, #0b0f14 60%);
  color:var(--text);
  letter-spacing:0.1px;
}

.container {
  max-width:1200px;
  margin:auto;
  padding:30px;
}

h1 {
  font-size:30px;
  font-weight:700;
  letter-spacing:0.2px;
  margin-bottom:6px;
}

h3 {
  font-size:18px;
  font-weight:600;
  margin:28px 0 14px;
  color:#dbe2f1;
}

.updated {
  font-size:13px;
  font-weight:500;
  color:var(--muted);
  margin-bottom:22px;
}

.banner {
  background:linear-gradient(90deg,#0f1c2d,#0c1320);
  border-left:4px solid var(--info);
  padding:14px 18px;
  border-radius:14px;
  margin-bottom:28px;
  font-size:14px;
  font-weight:600;
  box-shadow:var(--glow-info);
}

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:22px;
}

.card {
  background:linear-gradient(180deg,#121826,#0f1523);
  border:1px solid var(--card-border);
  border-radius:18px;
  padding:22px;
  box-shadow:0 12px 34px rgba(0,0,0,.45);
}

.asset {
  font-size:20px;
  font-weight:600;
  letter-spacing:0.15px;
  margin-bottom:6px;
}

.bias {
  font-size:40px;
  font-weight:800;
  margin-bottom:6px;
  letter-spacing:0.4px;
}

.bias.bullish { color:var(--bull); text-shadow:var(--glow-bull); }
.bias.bearish { color:var(--bear); text-shadow:var(--glow-bear); }
.bias.neutral { color:var(--neutral); text-shadow:var(--glow-neutral); }

.conf {
  font-size:13px;
  font-weight:500;
  color:var(--muted);
  margin-bottom:12px;
}

ul {
  padding-left:18px;
  margin:0;
}

li {
  font-size:14px;
  font-weight:500;
  margin-bottom:6px;
  color:#cfd6e4;
}

.permission {
  font-size:24px;
  font-weight:800;
  margin-top:10px;
  letter-spacing:0.3px;
}

.permission.green { color:var(--bull); text-shadow:var(--glow-bull); }
.permission.amber { color:var(--neutral); text-shadow:var(--glow-neutral); }
.permission.red { color:var(--bear); text-shadow:var(--glow-bear); }

select {
  width:100%;
  margin-top:8px;
  padding:10px 12px;
  background:#0b0f14;
  color:var(--text);
  border:1px solid var(--card-border);
  border-radius:8px;
  font-size:14px;
  font-family:inherit;
}

.badge {
  display:inline-block;
  padding:6px 14px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  letter-spacing:0.4px;
}

.badge.on {
  color:var(--bull);
  border:1px solid rgba(0,255,156,.45);
  box-shadow:var(--glow-bull);
}

.badge.off {
  color:var(--bear);
  border:1px solid rgba(255,77,77,.45);
  box-shadow:var(--glow-bear);
}

.badge.mixed {
  color:var(--neutral);
  border:1px solid rgba(255,204,0,.45);
  box-shadow:var(--glow-neutral);
}

.regime-explain {
  margin-top:14px;
  font-size:14px;
  font-weight:500;
  line-height:1.6;
  color:#cfd6e4;
}

.ai-box {
  margin-top:16px;
  padding:14px;
  border-radius:14px;
  background:linear-gradient(180deg,#0c1525,#0a1220);
  border:1px solid #1f2b44;
  box-shadow:var(--glow-info);
}

.ai-title {
  font-size:11px;
  font-weight:700;
  letter-spacing:0.6px;
  color:var(--info);
  margin-bottom:6px;
  text-transform:uppercase;
}

.ai-text {
  font-size:14px;
  font-weight:500;
  line-height:1.5;
}
</style>
</head>

<body>
<div class="container">

<h1>Macro Execution Dashboard</h1>
<div class="updated" id="updated">Loading…</div>

<div class="banner" id="riskBanner">Checking macro risk…</div>

<div class="grid">
  <div class="card" id="us500"></div>
  <div class="card" id="gold"></div>
</div>

<h3>15-Minute EMA Bias (Manual)</h3>
<div class="grid">
  <div class="card" id="us500Permission"></div>
  <div class="card" id="goldPermission"></div>
</div>

<h3>Market Regime</h3>
<div class="card" id="regime"></div>

</div>

<script>
fetch("latest.json")
.then(r => r.json())
.then(data => {

  document.getElementById("updated").innerText =
    "Last updated (UTC): " + data.updated_utc.replace("T"," ").split(".")[0];

  if (data.macro_risk && data.macro_risk.risk) {
    riskBanner.innerHTML = "⚠️ " + data.macro_risk.message;
    riskBanner.style.borderLeftColor = "var(--bear)";
  } else {
    riskBanner.innerHTML = "✅ No high-impact macro risk (CPI / FOMC / NFP)";
    riskBanner.style.borderLeftColor = "var(--bull)";
  }

  renderAsset("us500","US500",data.us500);
  renderAsset("gold","Gold (XAUUSD)",data.gold);

  const emaBias = {
    us500: localStorage.getItem("ema_us500") || "Neutral",
    gold: localStorage.getItem("ema_gold") || "Neutral"
  };

  renderPermission("us500Permission","US500",data.us500,"ema_us500",emaBias.us500);
  renderPermission("goldPermission","Gold",data.gold,"ema_gold",emaBias.gold);

  const regime = data.risk_regime || "Mixed";
  const cls = regime === "Risk-On" ? "on" : regime === "Risk-Off" ? "off" : "mixed";

  document.getElementById("regime").innerHTML = `
    <div class="badge ${cls}">${regime}</div>
    <div class="regime-explain">
      <strong>Risk-On:</strong> Trend continuation favoured, pullbacks buyable.<br>
      <strong>Risk-Off:</strong> Defensive conditions, failed breaks common.<br>
      <strong>Mixed:</strong> No dominant tailwind — A+ setups only.
    </div>
  `;
});

function renderAsset(id,title,obj){
  const cls=obj.bias.toLowerCase();
  document.getElementById(id).innerHTML = `
    <div class="asset">${title}</div>
    <div class="bias ${cls}">${obj.bias}</div>
    <div class="conf">Confidence: ${obj.confidence}</div>
    <ul>${obj.drivers.map(d=>`<li>${d}</li>`).join("")}</ul>
    ${obj.macro_summary ? `
      <div class="ai-box">
        <div class="ai-title">Macro Interpretation</div>
        <div class="ai-text">${escapeHtml(obj.macro_summary)}</div>
      </div>` : ""}
  `;
}

function renderPermission(id,title,fund,storageKey,currentBias){
  let text="Stand Aside", cls="red";
  if (currentBias===fund.bias && fund.confidence==="High"){ text="Full Size Allowed"; cls="green";}
  else if (currentBias===fund.bias){ text="Reduce Size / A+ Only"; cls="amber";}

  document.getElementById(id).innerHTML = `
    <div class="asset">${title}</div>
    <label class="conf">15m EMA Bias</label>
    <select onchange="updateBias('${storageKey}', this.value)">
      <option ${currentBias==="Bullish"?"selected":""}>Bullish</option>
      <option ${currentBias==="Bearish"?"selected":""}>Bearish</option>
      <option ${currentBias==="Neutral"?"selected":""}>Neutral</option>
    </select>
    <div class="permission ${cls}">${text}</div>
  `;
}

function updateBias(key,value){
  localStorage.setItem(key,value);
  location.reload();
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>
